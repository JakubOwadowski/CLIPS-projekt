(defrule p1 => (assert (p1)) (printout t "How old are you?" crlf))
(defrule p1_assert ?temp <- (p1) ?answer <- (a $?a) => (retract ?answer) (retract ?temp) (assert (p1 $?a)))
(defrule p2 (p1 Under 18) => (assert (p2)) (printout t "Are you male or female?" crlf))
(defrule p2_assert ?temp <- (p2) ?answer <- (a $?a) => (retract ?answer) (retract ?temp) (assert (p2 $?a)))
(defrule a1 (p2 Female) (p1 Under 18) => (assert (finish)) (printout t "Your movie is Twilight" crlf))
(defrule p3 (p2 Male) (p1 Under 18) => (assert (p3)) (printout t "Are you Catholic?" crlf))
(defrule p3_assert ?temp <- (p3) ?answer <- (a $?a) => (retract ?answer) (retract ?temp) (assert (p3 $?a)))
(defrule a2 (p3 Yes) (p2 Male) (p1 Under 18) => (assert (finish)) (printout t "Your movie is Killer Nun" crlf))
(defrule a3 (p3 No) (p2 Male) (p1 Under 18) => (assert (finish)) (printout t "Your movie is Slaughter Hotel" crlf))